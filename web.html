<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kalengo Nest</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/nest_doc/assets/css/0.styles.4faf72c7.css" as="style"><link rel="preload" href="/nest_doc/assets/js/app.b1a0d47c.js" as="script"><link rel="preload" href="/nest_doc/assets/js/2.24517c18.js" as="script"><link rel="preload" href="/nest_doc/assets/js/6.2d497e0d.js" as="script"><link rel="prefetch" href="/nest_doc/assets/js/10.e7d7cb83.js"><link rel="prefetch" href="/nest_doc/assets/js/11.f8bfe011.js"><link rel="prefetch" href="/nest_doc/assets/js/12.e23ce722.js"><link rel="prefetch" href="/nest_doc/assets/js/13.747b8cdb.js"><link rel="prefetch" href="/nest_doc/assets/js/14.265e612d.js"><link rel="prefetch" href="/nest_doc/assets/js/15.e80a3a95.js"><link rel="prefetch" href="/nest_doc/assets/js/16.3a4c3794.js"><link rel="prefetch" href="/nest_doc/assets/js/17.efa2bdcf.js"><link rel="prefetch" href="/nest_doc/assets/js/18.0fae3a9b.js"><link rel="prefetch" href="/nest_doc/assets/js/19.2cd70058.js"><link rel="prefetch" href="/nest_doc/assets/js/20.efbce666.js"><link rel="prefetch" href="/nest_doc/assets/js/21.10fb3df3.js"><link rel="prefetch" href="/nest_doc/assets/js/22.8b98c14b.js"><link rel="prefetch" href="/nest_doc/assets/js/23.155f7dae.js"><link rel="prefetch" href="/nest_doc/assets/js/3.22a61b81.js"><link rel="prefetch" href="/nest_doc/assets/js/4.f5c44c06.js"><link rel="prefetch" href="/nest_doc/assets/js/5.fb3460a9.js"><link rel="prefetch" href="/nest_doc/assets/js/7.35fa505a.js"><link rel="prefetch" href="/nest_doc/assets/js/8.8f83fa99.js"><link rel="prefetch" href="/nest_doc/assets/js/9.a732d068.js">
    <link rel="stylesheet" href="/nest_doc/assets/css/0.styles.4faf72c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nest_doc/" class="home-link router-link-active"><!----> <span class="site-name">Kalengo Nest</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nest_doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/nest_doc/quickstart.html" class="nav-link">
  快速开始
</a></div><div class="nav-item"><a href="https://github.com/kaolalicai/klg-nest-starter" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nest_doc/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/nest_doc/quickstart.html" class="nav-link">
  快速开始
</a></div><div class="nav-item"><a href="https://github.com/kaolalicai/klg-nest-starter" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/nest_doc/quickstart" class="sidebar-heading clickable open"><span>从 Web 开始</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/nest_doc/quickstart.html" class="sidebar-link">快速开始</a></li><li><a href="/nest_doc/web.html" class="active sidebar-link">Web生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nest_doc/web.html#先理解-nest-的-module" class="sidebar-link">先理解 Nest 的 Module</a></li><li class="sidebar-sub-header"><a href="/nest_doc/web.html#定义一个路由" class="sidebar-link">定义一个路由</a></li><li class="sidebar-sub-header"><a href="/nest_doc/web.html#参数校验-dto" class="sidebar-link">参数校验 DTO</a></li><li class="sidebar-sub-header"><a href="/nest_doc/web.html#集合参数-todo" class="sidebar-link">集合参数(TODO)</a></li><li class="sidebar-sub-header"><a href="/nest_doc/web.html#request-log" class="sidebar-link">Request Log</a></li><li class="sidebar-sub-header"><a href="/nest_doc/web.html#response-format" class="sidebar-link">Response Format</a></li><li class="sidebar-sub-header"><a href="/nest_doc/web.html#统一的异常处理" class="sidebar-link">统一的异常处理</a></li><li class="sidebar-sub-header"><a href="/nest_doc/web.html#接口文档-swagger" class="sidebar-link">接口文档 Swagger</a></li></ul></li><li><a href="/nest_doc/test.html" class="sidebar-link">测试</a></li></ul></section></li><li><a href="/nest_doc/database/mongoose.html" class="sidebar-link">Database</a></li><li><a href="/nest_doc/config.html" class="sidebar-link">应用配置</a></li><li><section class="sidebar-group depth-0"><a href="/nest_doc/extend/redis" class="sidebar-heading clickable"><span>其他技术</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/nest_doc/extend/redis.html" class="sidebar-link">Redis</a></li><li><a href="/nest_doc/extend/rabbitmq.html" class="sidebar-link">RabbitMQ</a></li><li><a href="/nest_doc/extend/keycloak.html" class="sidebar-link">Keycloak SSO 认证和授权</a></li><li><a href="/nest_doc/extend/logger.html" class="sidebar-link">日志 Logger</a></li><li><a href="/nest_doc/extend/event.html" class="sidebar-link">事件处理 Event</a></li><li><a href="/nest_doc/extend/crud.html" class="sidebar-link">CRUD</a></li><li><a href="/nest_doc/extend/ms.html" class="sidebar-link">微服务调用</a></li><li><a href="/nest_doc/extend/workflow.html" class="sidebar-link">工作流/微服务编排</a></li><li><a href="/nest_doc/extend/decorator.html" class="sidebar-link">自定义注解</a></li></ul></section></li><li><a href="/nest_doc/code-style.html" class="sidebar-link">代码风格</a></li><li><a href="/nest_doc/utils.html" class="sidebar-link">常用工具</a></li><li><a href="/nest_doc/contribut.html" class="sidebar-link">如何贡献</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>接下来我们将从一个请求开始说起，如何一步一步构架一个 Web 服务</p> <p>本教程的完整示例见 <a href="https://github.com/kaolalicai/klg-nest-starter/tree/master/sample/hello-world" target="_blank" rel="noopener noreferrer">hello-world<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="先理解-nest-的-module"><a href="#先理解-nest-的-module" class="header-anchor">#</a> 先理解 Nest 的 Module</h2> <p>Nest 默认提供了 Module 模块的概念，在继续本教程之前，请务必理解 Nest 的 <a href="https://docs.nestjs.cn/7/modules" target="_blank" rel="noopener noreferrer">Module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
其核心概念有：</p> <ul><li>providers	由 Nest 注入器实例化的提供者，并且可以至少在整个模块中共享</li> <li>controllers	必须创建的一组控制器</li> <li>imports	导入模块的列表，这些模块导出了此模块中所需提供者</li> <li>exports	由本模块提供并应在其他模块中可用的提供者的子集。</li></ul> <p>假设一个场景，我们系统里定义两个 Module，UserModule 和 OrderModule.
在 UserModule 中我们定义了一个 UsersService</p> <blockquote><p>users.module.ts</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    TypegooseModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token punctuation">[</span>User<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'core'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>UsersController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>UsersService<span class="token punctuation">]</span>，
  exports<span class="token operator">:</span> <span class="token punctuation">[</span>UsersService<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UsersModule</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果我们要在 OrderModule 里使用 User 这个 UsersService 应该如何做呢？
前提是 UserModule 里必须把 UsersService 导出，然后在  OrderModule 里导入</p> <blockquote><p>order.module.ts</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code>@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    UserModule<span class="token punctuation">,</span>
    TypegooseModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Order<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'core'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>OrderController<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>OrderService<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">OrderModule</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后在 OrderService 中使用</p> <p>TODO</p> <h2 id="定义一个路由"><a href="#定义一个路由" class="header-anchor">#</a> 定义一个路由</h2> <p>Nest 使用注解式路由</p> <blockquote><p>cats.controller.ts</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>

@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CatsController</span> <span class="token punctuation">{</span>
  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'This action returns all cats'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>请求参数则通过 @Query @Body 等方式获取，具体见 <a href="https://docs.nestjs.cn/7/controllers" target="_blank" rel="noopener noreferrer">Nest文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="参数校验-dto"><a href="#参数校验-dto" class="header-anchor">#</a> 参数校验 DTO</h2> <p>在 Nest 框架中，最好使用 DTO 对象来完成参数的校验.</p> <p>例如在一个注册 register 接口中，我们将会定义一个 UserDto 对象表示注册需要的参数。</p> <blockquote><p>src/users/users.dto.ts</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> IsNotEmpty <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'class-validator'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BaseResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@kalengo/web'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserDto</span> <span class="token punctuation">{</span>
  @<span class="token function">IsNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> name<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span>
  @<span class="token function">IsNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> phone<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre></div><p>而且我们还在具体的属性上加了 @IsNotEmpty() 的注解，这样就可以通过 Nest 的中间件自动帮你完成参数校验。</p> <p>使用 DTO 的另一个好处： DTO 作为一个 class 定义的，可以方便地继承和重用。</p> <p>接下来讲讲如何配置 Validate 中间件。</p> <p>使用Nest 内置的 ValidationPipe，使用全局配置的方式</p> <div class="language-ts extra-class"><pre class="language-ts"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Module<span class="token punctuation">,</span> ValidationPipe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">APP_PIPE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      provide<span class="token operator">:</span> <span class="token constant">APP_PIPE</span><span class="token punctuation">,</span>
      useClass<span class="token operator">:</span> ValidationPipe
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre></div><p>但是这个 ValidationPipe 不会输出校验的错误明细信息，它只会抛出一个 BadRequestException，而且里面没有任何错误提示信息。
查看了 ValidationPipe 源码，应该是一个 BUG，ValidationPipe 抛出 error 的时候把 error 丢失了，这个时候前端收到的内容是</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token string">'Bad Request Exception'</span><span class="token punctuation">,</span>
  code<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
  url<span class="token operator">:</span> <span class="token string">'/api/v1/users/register'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一个笼统的错误提示。</p> <p>我们可以通过修改 ValidationPipe 来实现输出错误信息。</p> <div class="language-ts extra-class"><pre class="language-ts"><code>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> ValidationPipe<span class="token punctuation">,</span> ValidationError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpErrorByCode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common/utils/http-error-by-code.util'</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ParamsValidationPipe</span> <span class="token keyword">extends</span> <span class="token class-name">ValidationPipe</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token function">createExceptionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">validationErrors<span class="token operator">:</span> ValidationError<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isDetailedOutputDisabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HttpErrorByCode</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>errorHttpStatusCode<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// eslint-disable-next-line @typescript-eslint/ban-ts-ignore</span>
      <span class="token comment">// @ts-ignore</span>
      <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">flattenValidationErrors</span><span class="token punctuation">(</span>validationErrors<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HttpErrorByCode</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>errorHttpStatusCode<span class="token punctuation">]</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 把错误信息转为 string，这样就能抛出正确的 error</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>改用我们修改过的中间件</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">APP_PIPE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ParamsValidationPipe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@kalengo/web'</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      provide<span class="token operator">:</span> <span class="token constant">APP_PIPE</span><span class="token punctuation">,</span>
      useClass<span class="token operator">:</span> ParamsValidationPipe
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre></div><p>测试一下，返回内容变为</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token string">'phone should not be empty'</span><span class="token punctuation">,</span>
  code<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
  url<span class="token operator">:</span> <span class="token string">'/api/v1/users/register'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个修改版中间件将由 @kalengo/web 库提供</p> <p>更多配置方式和细节请看 Nest 官方文档 <a href="https://docs.nestjs.cn/7/pipes?id=%e7%b1%bb%e9%aa%8c%e8%af%81%e5%99%a8" target="_blank" rel="noopener noreferrer">类验证器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="集合参数-todo"><a href="#集合参数-todo" class="header-anchor">#</a> 集合参数(TODO)</h2> <p>在之前的开发经验中，为了方便处理参数，我们希望把 query body 的参数集合到一个对象 parameters 中,
我们可以通过一个中间件来实现</p> <h2 id="request-log"><a href="#request-log" class="header-anchor">#</a> Request Log</h2> <p>Nest 默认不提供 Request Log 的中间件，我们可以使用开源的 express 中间件 morgan，在 main.ts 中挂载即可</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>NestFactory<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> morgan <span class="token keyword">from</span> <span class="token string">'morgan'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ApplicationModule<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./app.module'</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ApplicationModule<span class="token punctuation">)</span>
  <span class="token comment">// request log</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">morgan</span><span class="token punctuation">(</span><span class="token string">'tiny'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">)</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Application(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) is running on: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>如果你有更复杂的日志需求，例如 log 存储分割等问题，请查阅本脚手架的<a href="https://kaolalicai.github.io/nest_doc/extend/logger.html" target="_blank" rel="noopener noreferrer">日志说明文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="response-format"><a href="#response-format" class="header-anchor">#</a> Response Format</h2> <p>实际业务中，我们需要统一接口的返回值，Nest 默认不提供此类中间件，我们可以自己实现一个，如何编写中间件，请看 <a href="https://docs.nestjs.cn/7/middlewares" target="_blank" rel="noopener noreferrer">Nest文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>transform.interceptor.ts</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Injectable<span class="token punctuation">,</span> NestInterceptor<span class="token punctuation">,</span> CallHandler<span class="token punctuation">,</span> ExecutionContext<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>map<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Observable<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span>

<span class="token keyword">interface</span> <span class="token class-name">Response</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">}</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">TransformInterceptor</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token keyword">implements</span> <span class="token class-name">NestInterceptor</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Response<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">intercept</span> <span class="token punctuation">(</span>context<span class="token operator">:</span> ExecutionContext<span class="token punctuation">,</span> next<span class="token operator">:</span> CallHandler<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>Response<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          data<span class="token punctuation">,</span>
          code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          message<span class="token operator">:</span> <span class="token string">'success'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>中间件写好了之后，在 app.module.ts 中全局挂载即可</p> <blockquote><p>src/app.module.ts</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UsersModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./users/users.module'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">APP_INTERCEPTOR</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TransformInterceptor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@kalengo/web'</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>UsersModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      provide<span class="token operator">:</span> <span class="token constant">APP_INTERCEPTOR</span><span class="token punctuation">,</span>
      useClass<span class="token operator">:</span> TransformInterceptor
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre></div><p><strong>注意</strong> 此类通用的中间件，我们会放入 @klg/web 包中</p> <h2 id="统一的异常处理"><a href="#统一的异常处理" class="header-anchor">#</a> 统一的异常处理</h2> <p>在 AppModule 注册全局的异常拦截器</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">APP_FILTER</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/core'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpExceptionFilter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@kalengo/web'</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>UsersModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      provide<span class="token operator">:</span> <span class="token constant">APP_FILTER</span><span class="token punctuation">,</span>
      useClass<span class="token operator">:</span> HttpExceptionFilter
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>注意这种写法是和下面的 useGlobalFilters 效果一致的，不过 useClass 方式可以注入其他实例。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">await</span> NestFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>AppModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">useGlobalFilters</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpExceptionFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>HttpExceptionFilter 默认拦截所有异常，并返回如下结构的 json 内容</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span>
<span class="token string">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Business Error&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/api/v1/xxx/xxx&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置好了拦截器，我们测试一下异常的情况，在 Controller 中抛出异常</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Controller<span class="token punctuation">,</span> Get <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BusinessException <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@kalengo/web'</span>

@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">{</span>

  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">'/err'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>@kalengo/web</code> 为大家提供了一个 BusinessException 对象，实际上是继承与 Nest 的 HttpException, 这里抛出的异常将会被我们配置的拦截器拦截并处理。</p> <p>我们可以根据业务需要编写更多的自定义异常。</p> <p>更多详细内容请查阅 <a href="https://docs.nestjs.cn/7/exceptionfilters" target="_blank" rel="noopener noreferrer">Nest文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="接口文档-swagger"><a href="#接口文档-swagger" class="header-anchor">#</a> 接口文档 Swagger</h2> <p>Nest 对 Swagger 有着非常好的集成，我们可以用注解的方式，直接在代码上编写接口文档。</p> <p>还是以注册接口为例，看看如何编写接口文档。</p> <blockquote><p>src/users/users.controller.ts</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code>
@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> <span class="token keyword">readonly</span> usersService<span class="token operator">:</span> UsersService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  @<span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">)</span>
  @<span class="token function">ApiOkResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    description<span class="token operator">:</span> <span class="token string">'find one account'</span><span class="token punctuation">,</span>
    <span class="token keyword">type</span><span class="token operator">:</span> RegisterRes
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token parameter">@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createUserDto<span class="token operator">:</span> UserDto</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>usersService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>createUserDto<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>在 Controller 中，我们声明了 register 所需要的参数是 UserDto，返回值是 ApiOkResponse 里声明的 RegisterRes</p> <p>这两个类型实际定义在 DTO 文件中</p> <blockquote><p>src/users/users.dto.ts</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> IsNotEmpty <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'class-validator'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ApiProperty <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/swagger'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BaseResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@kalengo/web'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserDto</span> <span class="token punctuation">{</span>
  @<span class="token function">IsNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  @<span class="token function">ApiProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> name<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span>
  @<span class="token function">IsNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  @<span class="token function">ApiProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> phone<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">RegisterRes</span> <span class="token keyword">extends</span> <span class="token class-name">BaseResponse</span> <span class="token punctuation">{</span>
  @<span class="token function">ApiProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">:</span> UserDto <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">readonly</span> data<span class="token operator">!</span><span class="token operator">:</span> UserDto
<span class="token punctuation">}</span>
</code></pre></div><p>使用了 @ApiProperty 注解声明了 DTO 的字段，这些声明将会用于生成 Swagger 文档.</p> <p><strong>注意</strong>，DTO 每个字段都需要注释还是比较麻烦的，Nest Swagger 为了解决这个问题，提供了自动扫描插件，
该插件会尝试读取 typescript 信息，自动生成 API 文档需要的信息，详情见 <a href="https://docs.nestjs.cn/7/recipes?id=%e6%8f%92%e4%bb%b6" target="_blank" rel="noopener noreferrer">插件文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>最终，生成好的接口文档长这样:</p> <p><img src="/nest_doc/assets/img/swagger.f66aff05.png" alt=""></p> <p>可以看到，参数类型和返回值类型都被准确声明了。</p> <p>后端开发可以先写好接口设计，然后使用这份文档和前端沟通</p> <p>更多细节请看 Nest 官方文档 <a href="https://docs.nestjs.cn/7/recipes?id=openapi-swagger" target="_blank" rel="noopener noreferrer">OpenAPI (Swagger)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nest_doc/quickstart.html" class="prev">
        快速开始
      </a></span> <span class="next"><a href="/nest_doc/test.html">
        测试
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/nest_doc/assets/js/app.b1a0d47c.js" defer></script><script src="/nest_doc/assets/js/2.24517c18.js" defer></script><script src="/nest_doc/assets/js/6.2d497e0d.js" defer></script>
  </body>
</html>
